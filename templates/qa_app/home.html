{% extends 'qa_app/base.html' %}

{% block title %}Ask Questions - Semilattice Q&A{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Ask Questions</h1>
    <p class="text-gray-600">Submit questions to any population and get AI-powered response predictions</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Main Question Form -->
    <div class="lg:col-span-2">
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-medium text-gray-900">Ask a Question</h2>
                <p class="text-sm text-gray-500">Submit a question to simulate responses from a population using Semilattice AI</p>
            </div>
            
            <form method="post" action="{% url 'ask_question' %}" class="p-6 space-y-6">
                {% csrf_token %}
                
                <!-- Population Selection -->
                <div>
                    <label for="population_id" class="block text-sm font-medium text-gray-700">Population ID</label>
                    <input 
                        type="text" 
                        id="population_id" 
                        name="population_id" 
                        required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary sm:text-sm border px-3 py-2"
                        placeholder="Enter population ID (e.g., pop_xxx...)"
                    >
                    <p class="mt-1 text-xs text-gray-500">
                        Enter the population ID from your Semilattice dashboard or 
                        <a href="{% url 'manage_populations' %}" class="text-secondary hover:text-blue-700">manage populations</a>
                    </p>
                </div>

                <!-- Question -->
                <div>
                    <label for="question" class="block text-sm font-medium text-gray-700">Question</label>
                    <input 
                        type="text" 
                        id="question" 
                        name="question" 
                        required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary sm:text-sm border px-3 py-2"
                        placeholder="e.g., Which pricing model do you prefer?"
                        value="Which pricing model do you prefer?"
                    >
                </div>

                <!-- Question Type -->
                <div>
                    <label for="question_type" class="block text-sm font-medium text-gray-700">Question Type</label>
                    <select 
                        id="question_type" 
                        name="question_type"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary sm:text-sm border px-3 py-2 bg-white"
                        onchange="toggleAnswerOptions()"
                    >
                        <option value="single-choice">Single Choice</option>
                        <option value="multiple-choice">Multiple Choice</option>
                        <option value="free-text">Free Text</option>
                    </select>
                </div>

                <!-- Answer Options -->
                <div id="answer_options_div">
                    <label for="answer_options" class="block text-sm font-medium text-gray-700">Answer Options</label>
                    <textarea 
                        id="answer_options" 
                        name="answer_options"
                        rows="4"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-secondary focus:ring-secondary sm:text-sm border px-3 py-2"
                        placeholder="Enter one option per line..."
                    >Usage-based
Monthly
Annual (discount)</textarea>
                    <p class="mt-1 text-xs text-gray-500">Enter one answer option per line</p>
                </div>

                <!-- Submit Button -->
                <div>
                    <button 
                        type="submit"
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-secondary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary transition-colors"
                    >
                        Ask Question
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="lg:col-span-1">
        <!-- Recent Questions -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Recent Questions</h3>
            </div>
            <div class="p-6">
                {% if recent_questions %}
                    <div class="space-y-4">
                        {% for question in recent_questions %}
                            <div class="border-l-4 border-secondary pl-4">
                                <div class="text-sm text-gray-900">
                                    <a href="{% url 'question_detail' question.id %}" class="hover:text-secondary">
                                        {{ question.question_text|truncatechars:60 }}
                                    </a>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    {{ question.population.name }} â€¢ {{ question.created_at|timesince }} ago
                                    {% if question.result %}
                                        <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
                                            {% if question.result.status == 'Predicted' %}bg-green-100 text-green-800
                                            {% elif question.result.status == 'Running' %}bg-yellow-100 text-yellow-800
                                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                                            {{ question.result.status }}
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-sm text-gray-500">No questions asked yet. Be the first!</p>
                {% endif %}
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="mt-6 bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Quick Stats</h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-secondary">{{ populations.count }}</div>
                        <div class="text-sm text-gray-500">Population{{ populations.count|pluralize }}</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-secondary">{{ recent_questions.count }}</div>
                        <div class="text-sm text-gray-500">Question{{ recent_questions.count|pluralize }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleAnswerOptions() {
    const questionType = document.getElementById('question_type').value;
    const answerOptionsDiv = document.getElementById('answer_options_div');
    
    if (questionType === 'free-text') {
        answerOptionsDiv.style.display = 'none';
    } else {
        answerOptionsDiv.style.display = 'block';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleAnswerOptions();
});
</script>
{% endblock %}
